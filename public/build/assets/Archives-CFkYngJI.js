import{d as et,r as b,w as xe,c as te,u as _e,a as tt,o as st,b as p,e as n,f as r,g as t,h as o,i as at,j as v,k as D,l as i,F as M,m as L,n as h,p as se,t as u,q as R,s as $,v as C,x as O,y as lt,z as ge,A as H,B as z}from"./app-CfhKYtt7.js";import{_ as ae}from"./InputError.vue_vue_type_script_setup_true_lang-DgiORpTY.js";import{_ as x}from"./index-DGVHeVnd.js";import{_ as J,a as Q,b as X,c as Y}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DRKyjPaX.js";import{_ as le,a as be}from"./DialogFooter.vue_vue_type_script_setup_true_lang-lkXg9YbF.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-CteKsvKh.js";import{_ as oe}from"./Label.vue_vue_type_script_setup_true_lang-Cup1MZqB.js";import{_ as ot,X as nt}from"./AppLayout.vue_vue_type_script_setup_true_lang-CuPyALle.js";import{E as rt,R as it}from"./refresh-cw-h8CGfaci.js";import{D as ut,U as dt}from"./upload-k8hNVInr.js";import{M as ye,P as ct}from"./plus-D2otycPr.js";import{C as pt}from"./check-CFU1Lxtz.js";import{c as vt}from"./createLucideIcon-6vwJQ8y7.js";import{L as ft}from"./loader-circle-DwXVPNX8.js";import"./useForwardPropsEmits-BMR9Dotv.js";import"./index-DI3qepia.js";import"./useForwardExpose-iik2X7Kc.js";import"./VisuallyHidden-CsCPmOFa.js";import"./index-CqmfE78h.js";import"./index-CSEUMRIG.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CJkCubQI.js";const mt=vt("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),xt={class:"flex flex-col gap-6 p-4"},_t={class:"flex items-center justify-between"},gt={class:"flex flex-wrap gap-2"},bt={class:"grid gap-6 lg:grid-cols-[280px_1fr]"},ht={class:"rounded-md border"},yt={class:"divide-y"},wt=["onClick"],kt=["onClick"],$t={key:0,class:"px-4 py-6 text-center text-sm text-muted-foreground"},St={class:"rounded-md border"},Ct={class:"flex items-center justify-between border-b px-4 py-2"},zt={class:"text-xs text-muted-foreground"},Nt={class:"w-full text-sm"},jt={class:"px-4 py-2"},Pt={class:"px-4 py-2"},Dt={class:"px-4 py-2"},At={class:"px-4 py-2 text-sm text-muted-foreground"},Mt={class:"px-4 py-2 text-sm text-muted-foreground"},Ut={class:"px-4 py-2 text-sm text-muted-foreground"},Vt={class:"px-4 py-2 text-sm text-muted-foreground"},Ft={class:"px-4 py-2 text-sm text-muted-foreground"},Tt={class:"flex flex-col gap-0.5"},Et={class:"font-medium text-foreground"},It={class:"text-xs text-muted-foreground"},Bt={class:"px-4 py-2"},Lt=["onClick"],Rt=["href"],Ot={key:0},qt={class:"grid gap-2"},Kt={class:"grid gap-2"},Zt=["value","disabled"],Gt={class:"grid gap-2"},Ht=["onKeydown"],Jt={class:"flex h-14 w-14 items-center justify-center rounded-full bg-muted-foreground/15 text-foreground"},Qt=["disabled"],Xt={key:0,class:"text-xs text-destructive"},Yt={key:0,class:"min-h-0 flex-1 overflow-auto rounded-md border"},Wt={class:"w-full table-fixed text-xs"},es={class:"px-3 py-2"},ts={class:"truncate"},ss={key:0,class:"text-destructive"},as={class:"px-3 py-2 text-muted-foreground"},ls={class:"px-3 py-2"},os={class:"flex items-center gap-2"},ns={class:"h-1.5 w-24 rounded-full bg-muted"},rs={class:"text-muted-foreground"},is={class:"flex flex-wrap items-center justify-between gap-2"},us={class:"flex max-h-[70vh] flex-col gap-4"},ds={key:0,class:"text-sm text-muted-foreground"},cs={key:1,class:"flex min-h-0 flex-1 flex-col gap-4"},ps={class:"flex min-h-0 flex-col rounded-md border bg-background p-3 h-[70vh] overflow-hidden"},vs={class:"flex h-full flex-col gap-4 lg:flex-row"},fs={class:"flex min-h-0 flex-1 flex-col"},ms={class:"mb-3 flex items-center justify-between"},xs={class:"text-sm font-medium"},_s={class:"flex min-h-0 flex-1 flex-col"},gs={key:0,class:"flex items-center gap-3 text-sm text-muted-foreground"},bs={key:1,class:"min-h-0 flex-1 overflow-auto"},hs={class:"flex min-w-full justify-center"},ys=["src"],ws={key:2,class:"mt-3 flex flex-wrap items-center justify-between gap-2"},ks={class:"flex items-center gap-2"},$s={class:"min-w-[56px] text-center text-xs font-medium text-muted-foreground"},Ss={class:"text-sm text-muted-foreground"},Cs={class:"flex min-h-0 flex-1 flex-col rounded-md border bg-background p-3 overflow-hidden"},zs={class:"text-xs text-muted-foreground"},Ns={class:"min-h-0 flex-1 overflow-auto whitespace-pre-wrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-xs"},js={class:"flex min-h-0 flex-1 flex-col rounded-md border bg-background p-3 overflow-hidden"},Ps={class:"flex flex-wrap items-center justify-between gap-2"},Ds={class:"flex flex-wrap gap-2"},As={class:"min-h-0 flex-1 overflow-auto rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-xs"},Ms={class:"whitespace-pre-wrap"},Us={class:"flex min-h-0 flex-1 flex-col rounded-md border bg-background p-3 overflow-hidden"},Vs={key:0,class:"text-sm text-muted-foreground"},Fs={key:1,class:"min-h-0 flex-1 overflow-auto"},Ts={class:"w-full text-sm"},Es={class:"px-3 py-2 text-xs text-muted-foreground"},Is={class:"px-3 py-2 text-xs text-muted-foreground"},Bs={class:"px-3 py-2 text-xs"},Ls={class:"px-3 py-2 text-sm text-foreground"},Rs={class:"lg:w-[320px] lg:shrink-0 lg:sticky lg:top-4 lg:self-start"},Os={class:"space-y-4"},qs={class:"mt-2 flex items-center gap-2"},Ks={class:"grid gap-2 text-sm"},Zs={class:"flex items-center justify-between"},Gs={class:"font-medium text-foreground"},Hs={class:"flex items-center justify-between"},Js={class:"font-medium text-foreground"},Qs={class:"flex items-center justify-between"},Xs={class:"font-medium text-foreground"},Ys={class:"space-y-2"},Ws={class:"flex items-center justify-between text-sm"},ea={class:"text-foreground"},ta={class:"grid gap-2"},sa=["href"],we=.1,ke=.2,$e=2.5,$a=et({__name:"Archives",props:{archives:{},documents:{}},setup(Se){const N=Se,Ce=[{title:"Archiv",href:"/archives"}],_=b(null);xe(()=>{!_.value&&N.archives.length>0&&(_.value=N.archives[0].id)});function ze(a){const e=new Map;a.forEach(y=>{const d=y.parent_id??null;e.has(d)||e.set(d,[]),e.get(d).push(y)});const s=[];function m(y,d){(e.get(y)??[]).forEach(P=>{s.push({archive:P,depth:d}),m(P.id,d+1)})}return m(null,0),s}const ne=te(()=>ze(N.archives)),re=te(()=>_.value?N.documents.filter(a=>a.archive_id===_.value):[]);function ie(a){if(!a&&a!==0)return"-";if(a<1024)return`${a} B`;const e=["KB","MB","GB","TB"];let s=a/1024,m=0;for(;s>=1024&&m<e.length-1;)s/=1024,m+=1;const y=s>=10?Math.round(s):Math.round(s*10)/10;return`${String(y).replace(".",",")} ${e[m]}`}function c(a){switch(a){case"processing":return{icon:ft,className:"text-blue-600",spin:!0};case"queued":case"pending":return{icon:mt,className:"text-amber-600"};case"done":return{icon:pt,className:"text-emerald-600"};case"failed":return{icon:nt,className:"text-rose-600"};default:return{icon:ye,className:"text-muted-foreground"}}}function ue(a){const e=new Date(a);if(Number.isNaN(e.getTime()))return a;const s=We=>String(We).padStart(2,"0"),m=s(e.getDate()),y=s(e.getMonth()+1),d=e.getFullYear(),A=s(e.getHours()),P=s(e.getMinutes()),Ye=s(e.getSeconds());return`${m}.${y}.${d} ${A}:${P}:${Ye}`}function Ne(a){return ue(a)}function je(a){return a==="error"?"bg-rose-100 text-rose-700":a==="warning"?"bg-amber-100 text-amber-800":"bg-emerald-100 text-emerald-700"}const U=b(!1),j=b(null),q=b(!1),K=b(!1),W=b(!1),Z=b([]),de=b(null),f=_e({name:"",parent_id:""});function G(){U.value=!1,j.value=null,f.reset(),f.clearErrors()}function Pe(a){if(!a){G();return}U.value=!0}function ce(){q.value=!1,Z.value=[],S.reset(),S.clearErrors()}function De(a){if(!a){ce();return}q.value=!0}function Ae(){j.value=null,f.reset(),f.parent_id=_.value?String(_.value):"",f.clearErrors(),U.value=!0}function Me(a){j.value=a,f.name=a.name,f.parent_id=a.parent_id?String(a.parent_id):"",f.clearErrors(),U.value=!0}function Ue(){const a={name:f.name,parent_id:f.parent_id?Number(f.parent_id):null};if(j.value){f.put(`/archives/${j.value.id}`,{data:a,onSuccess:G});return}f.post("/archives",{data:a,onSuccess:G})}const S=_e({archive_id:"",file:null});function pe(a){if(!_.value||a.length===0||W.value)return;const e=new Set(N.documents.filter(d=>d.archive_id===_.value).map(d=>`${d.original_filename??d.name}:${d.size??0}`)),s=new Set,m=a.map(d=>{const A=`${d.name}:${d.size}`,P=e.has(A)||s.has(A);return s.add(A),{id:`${d.name}-${d.size}-${d.lastModified}`,name:d.name,size:d.size,progress:0,status:P?"duplicate":"queued",message:P?"Súbor už existuje v tomto adresári.":void 0,file:d}});Z.value=m;const y=m.filter(d=>d.status==="queued");y.length!==0&&Ve(y)}async function Ve(a){W.value=!0;for(const e of a)await Fe(e);W.value=!1}function Fe(a){return S.clearErrors(),S.archive_id=String(_.value??""),S.file=a.file,a.status="uploading",a.progress=0,new Promise(e=>{S.post("/archive-documents",{forceFormData:!0,onProgress:s=>{a.progress=s.percentage},onSuccess:()=>{a.status="done",a.progress=100},onError:s=>{const m=s.file??s.archive_id??"Nepodarilo sa nahrať súbor.";a.status=m==="Súbor už existuje v tomto adresári."?"duplicate":"error",a.message=m},onFinish:()=>{S.reset("file"),e()}})})}function Te(a){const e=a.target,s=e.files?Array.from(e.files):[];pe(s),e.value=""}function Ee(a){a.preventDefault(),K.value=!1;const e=a.dataTransfer?.files?Array.from(a.dataTransfer.files):[];pe(e)}function Ie(a){a.preventDefault(),K.value=!0}function Be(a){a.preventDefault(),K.value=!1}function ee(){_.value&&de.value?.click()}function Le(a){z.post(`/archive-documents/${a}/process`,{},{preserveScroll:!0,onSuccess:()=>{z.reload({only:["documents"],preserveScroll:!0})}})}function ve(a){l.value&&z.post(`/archive-documents/${l.value.id}/process`,{mode:a},{preserveScroll:!0,onSuccess:()=>{z.reload({only:["documents"],preserveScroll:!0})},onFinish:()=>{E.value=!1}})}function Re(a){z.post(`/archive-documents/${a}/generate-diary`,{},{preserveScroll:!0})}const V=b(!1),l=b(null),F=b(""),T=b(!1),E=b(!1),w=b(1),k=b(1),g=b("preview");let I=null;const Oe=te(()=>!l.value||l.value.preview_status!=="done"?"":`/archive-documents/${l.value.id}/preview/${w.value}`);function qe(a){l.value=a,w.value=1,k.value=1,g.value="preview",V.value=!0,F.value=a.name}function Ke(){V.value=!1,l.value=null,w.value=1,k.value=1,g.value="preview",F.value="",T.value=!1,B()}function Ze(){!l.value||T.value||(T.value=!0,z.put(`/archive-documents/${l.value.id}`,{archive_id:l.value.archive_id,name:F.value,type:l.value.type},{preserveScroll:!0,onSuccess:()=>{z.reload({only:["documents"],preserveScroll:!0})},onFinish:()=>{T.value=!1}}))}function Ge(){l.value&&(E.value=!0)}function He(){w.value>1&&(w.value-=1)}function Je(){const a=l.value?.preview_page_count??0;w.value<a&&(w.value+=1)}function Qe(){k.value=Math.min($e,+(k.value+we).toFixed(2))}function Xe(){k.value=Math.max(ke,+(k.value-we).toFixed(2))}function B(){I&&(clearInterval(I),I=null)}function fe(){I||(I=setInterval(()=>{z.reload({only:["documents"],preserveScroll:!0})},3e3))}function me(a){const e=["pending","queued","processing"];return e.includes(a.processing_status??"")||e.includes(a.preview_status??"")||e.includes(a.ocr_status??"")||e.includes(a.analyze_text_status??"")||e.includes(a.rag_status??"")}return tt(()=>V.value,a=>{if(!a){B();return}l.value&&me(l.value)?fe():B()}),xe(()=>{if(!l.value)return;const a=N.documents.find(e=>e.id===l.value?.id);if(a&&(l.value=a),!V.value||!me(l.value)){B();return}fe()}),st(()=>{B()}),(a,e)=>(i(),p(M,null,[n(ot,{breadcrumbs:Ce},{default:r(()=>[n(o(at),{title:"Archiv"}),t("div",xt,[t("div",_t,[e[19]||(e[19]=t("h1",{class:"text-2xl font-semibold"},"Archiv",-1)),t("div",gt,[n(o(x),{variant:"outline",onClick:Ae},{default:r(()=>[...e[17]||(e[17]=[v(" Pridať adresár ",-1)])]),_:1}),n(o(x),{disabled:!_.value,onClick:e[0]||(e[0]=s=>q.value=!0)},{default:r(()=>[...e[18]||(e[18]=[v(" Pridať súbory ",-1)])]),_:1},8,["disabled"])])]),t("div",bt,[t("div",ht,[e[20]||(e[20]=t("div",{class:"border-b px-4 py-2 text-sm font-medium"}," Adresáre ",-1)),t("div",yt,[(i(!0),p(M,null,L(ne.value,s=>(i(),p("button",{key:s.archive.id,type:"button",class:h(["flex w-full items-center justify-between px-4 py-2 text-left text-sm hover:bg-accent",_.value===s.archive.id?"bg-accent":""]),onClick:m=>_.value=s.archive.id},[t("span",{class:"truncate",style:se({paddingLeft:`${s.depth*16}px`})},u(s.archive.name),5),t("span",{class:"ml-2 text-xs text-muted-foreground",onClick:R(m=>Me(s.archive),["stop"])}," Upraviť ",8,kt)],10,wt))),128)),ne.value.length===0?(i(),p("div",$t," Žiadne adresáre. ")):D("",!0)])]),t("div",St,[t("div",Ct,[e[21]||(e[21]=t("div",{class:"text-sm font-medium"},"Dokumenty",-1)),t("div",zt,u(_.value?`Adresar #${_.value}`:"Vyber adresár"),1)]),t("table",Nt,[e[23]||(e[23]=t("thead",{class:"bg-muted"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left font-medium"}," Názov "),t("th",{class:"px-4 py-2 text-left font-medium"}," Typ "),t("th",{class:"px-4 py-2 text-left font-medium"}," Veľkosť "),t("th",{class:"px-4 py-2 text-left font-medium"}," Náhľad "),t("th",{class:"px-4 py-2 text-left font-medium"}," OCR "),t("th",{class:"px-4 py-2 text-left font-medium"}," Analyze "),t("th",{class:"px-4 py-2 text-left font-medium"}," RAG "),t("th",{class:"px-4 py-2 text-left font-medium"}," Spracovanie "),t("th",{class:"px-4 py-2 text-left font-medium"}," Akcie ")])],-1)),t("tbody",null,[(i(!0),p(M,null,L(re.value,s=>(i(),p("tr",{key:s.id,class:"border-t"},[t("td",jt,u(s.name),1),t("td",Pt,u(s.type),1),t("td",Dt,u(ie(s.size)),1),t("td",At,[(i(),$(C(c(s.preview_status).icon),{class:h(["h-4 w-4",[c(s.preview_status).className,c(s.preview_status).spin?"animate-spin":""]]),title:s.preview_status_label,"aria-label":s.preview_status_label},null,8,["class","title","aria-label"]))]),t("td",Mt,[(i(),$(C(c(s.ocr_status).icon),{class:h(["h-4 w-4",[c(s.ocr_status).className,c(s.ocr_status).spin?"animate-spin":""]]),title:s.ocr_status_label,"aria-label":s.ocr_status_label},null,8,["class","title","aria-label"]))]),t("td",Ut,[(i(),$(C(c(s.analyze_text_status).icon),{class:h(["h-4 w-4",[c(s.analyze_text_status).className,c(s.analyze_text_status).spin?"animate-spin":""]]),title:s.analyze_text_status_label,"aria-label":s.analyze_text_status_label},null,8,["class","title","aria-label"]))]),t("td",Vt,[(i(),$(C(c(s.rag_status).icon),{class:h(["h-4 w-4",[c(s.rag_status).className,c(s.rag_status).spin?"animate-spin":""]]),title:s.rag_status_label,"aria-label":s.rag_status_label},null,8,["class","title","aria-label"]))]),t("td",Ft,[t("div",Tt,[t("span",Et,u(s.processing_status_label),1),t("span",It,u(s.processing_step_label),1)])]),t("td",Bt,[t("button",{type:"button",class:"inline-flex items-center justify-center rounded-md border border-transparent p-1 text-muted-foreground transition hover:border-border hover:bg-muted hover:text-foreground","aria-label":"Zobraziť",title:"Zobraziť",onClick:m=>qe(s)},[n(o(rt),{class:"h-4 w-4"})],8,Lt),t("a",{href:`/archive-documents/${s.id}/download`,class:"ml-2 inline-flex items-center justify-center rounded-md border border-transparent p-1 text-muted-foreground transition hover:border-border hover:bg-muted hover:text-foreground","aria-label":"Stiahnuť",title:"Stiahnuť"},[n(o(ut),{class:"h-4 w-4"})],8,Rt)])]))),128)),re.value.length===0?(i(),p("tr",Ot,[...e[22]||(e[22]=[t("td",{class:"px-4 py-6 text-center text-muted-foreground",colspan:"9"}," Žiadne dokumenty. ",-1)])])):D("",!0)])])])])])]),_:1}),n(o(Y),{open:U.value,"onUpdate:open":Pe},{default:r(()=>[n(o(J),{class:"sm:max-w-lg"},{default:r(()=>[n(o(Q),null,{default:r(()=>[n(o(X),null,{default:r(()=>[v(u(j.value?"Upraviť adresár":"Pridať adresár"),1)]),_:1})]),_:1}),t("form",{class:"space-y-4",onSubmit:R(Ue,["prevent"])},[t("div",qt,[n(o(oe),{for:"archive-name"},{default:r(()=>[...e[24]||(e[24]=[v("Názov",-1)])]),_:1}),n(o(he),{id:"archive-name",name:"name",modelValue:o(f).name,"onUpdate:modelValue":e[1]||(e[1]=s=>o(f).name=s),autocomplete:"off"},null,8,["modelValue"]),n(ae,{message:o(f).errors.name},null,8,["message"])]),t("div",Kt,[n(o(oe),{for:"archive-parent"},{default:r(()=>[...e[25]||(e[25]=[v("Nadradený adresár",-1)])]),_:1}),O(t("select",{id:"archive-parent",class:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-xs outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","onUpdate:modelValue":e[2]||(e[2]=s=>o(f).parent_id=s)},[e[26]||(e[26]=t("option",{value:""},"-- koreň --",-1)),(i(!0),p(M,null,L(N.archives,s=>(i(),p("option",{key:s.id,value:s.id,disabled:j.value?.id===s.id},u(s.name),9,Zt))),128))],512),[[lt,o(f).parent_id]]),n(ae,{message:o(f).errors.parent_id},null,8,["message"])]),n(o(le),{class:"gap-2"},{default:r(()=>[n(o(be),{"as-child":""},{default:r(()=>[n(o(x),{type:"button",variant:"outline",onClick:G},{default:r(()=>[...e[27]||(e[27]=[v(" Zrušiť ",-1)])]),_:1})]),_:1}),n(o(x),{type:"submit",disabled:o(f).processing},{default:r(()=>[...e[28]||(e[28]=[v(" Uložiť ",-1)])]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),n(o(Y),{open:q.value,"onUpdate:open":De},{default:r(()=>[n(o(J),{class:"sm:max-w-5xl max-h-[85vh] overflow-hidden"},{default:r(()=>[n(o(Q),null,{default:r(()=>[n(o(X),null,{default:r(()=>[...e[29]||(e[29]=[v("Pridať súbory",-1)])]),_:1})]),_:1}),t("form",{class:"flex max-h-[70vh] flex-col gap-4",onSubmit:e[3]||(e[3]=R(()=>{},["prevent"]))},[t("div",Gt,[n(o(oe),{for:"archive-upload"},{default:r(()=>[...e[30]||(e[30]=[v("Súbory",-1)])]),_:1}),t("div",{class:h(["flex cursor-pointer flex-col items-center justify-center gap-3 rounded-md border border-dashed bg-muted/40 p-8 text-sm text-muted-foreground",K.value?"bg-accent":""]),role:"button",tabindex:"0",onClick:ee,onKeydown:[ge(R(ee,["prevent"]),["enter"]),ge(R(ee,["prevent"]),["space"])],onDrop:Ee,onDragover:Ie,onDragleave:Be},[t("div",Jt,[n(o(dt),{class:"h-7 w-7"})]),e[31]||(e[31]=t("div",{class:"text-sm font-medium text-foreground"}," Pretiahni súbory sem alebo klikni sem. ",-1)),t("input",{id:"archive-upload",ref_key:"uploadInputRef",ref:de,type:"file",class:"hidden",multiple:"",disabled:!_.value,onChange:Te},null,40,Qt)],42,Ht),_.value?D("",!0):(i(),p("div",Xt," Najprv vyber adresár. ")),n(ae,{message:o(S).errors.file},null,8,["message"])]),Z.value.length>0?(i(),p("div",Yt,[t("table",Wt,[e[32]||(e[32]=t("thead",{class:"bg-muted"},[t("tr",null,[t("th",{class:"w-1/2 px-3 py-2 text-left font-medium"}," Súbor "),t("th",{class:"w-1/5 px-3 py-2 text-left font-medium"}," Stav "),t("th",{class:"w-1/3 px-3 py-2 text-left font-medium"}," Priebeh ")])],-1)),t("tbody",null,[(i(!0),p(M,null,L(Z.value,s=>(i(),p("tr",{key:s.id,class:"border-t"},[t("td",es,[t("div",ts,u(s.name),1),s.message?(i(),p("div",ss,u(s.message),1)):D("",!0)]),t("td",as,u(s.status==="done"?"Hotovo":s.status==="uploading"?"Nahráva sa":s.status==="duplicate"?"Duplicita":s.status==="error"?"Chyba":"Čaká"),1),t("td",ls,[t("div",os,[t("div",ns,[t("div",{class:h(["h-1.5 rounded-full transition-all",s.status==="done"?"bg-primary":s.status==="error"?"bg-destructive":s.status==="duplicate"?"bg-muted-foreground":"bg-primary/60"]),style:se({width:s.status==="duplicate"?"100%":`${s.progress}%`})},null,6)]),t("span",rs,u(s.status==="duplicate"?"100%":`${s.progress}%`),1)])])]))),128))])])])):D("",!0),n(o(le),{class:"gap-2"},{default:r(()=>[n(o(be),{"as-child":""},{default:r(()=>[n(o(x),{type:"button",variant:"outline",onClick:ce},{default:r(()=>[...e[33]||(e[33]=[v(" Zrušiť ",-1)])]),_:1})]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),n(o(Y),{open:V.value,"onUpdate:open":Ke},{default:r(()=>[n(o(J),{class:"sm:max-w-6xl max-h-[85vh] overflow-hidden"},{default:r(()=>[n(o(Q),null,{default:r(()=>[t("div",is,[n(o(X),null,{default:r(()=>[...e[34]||(e[34]=[v("Detail dokumentu",-1)])]),_:1}),n(o(x),{type:"button",size:"sm",variant:"outline",disabled:!l.value||l.value.processing_status==="pending"||l.value.processing_status==="queued"||l.value.processing_status==="processing",onClick:e[4]||(e[4]=s=>l.value&&Le(l.value.id))},{default:r(()=>[n(o(it),{class:"mr-2 h-4 w-4"}),e[35]||(e[35]=v(" Spracovať ",-1))]),_:1},8,["disabled"])])]),_:1}),t("div",us,[l.value?(i(),p("div",cs,[t("div",ps,[t("div",vs,[t("div",fs,[t("div",ms,[t("div",xs,u(g.value==="preview"?"Náhľad":g.value==="ocr"?"OCR prepis":g.value==="processed"?"Spracované údaje":"Log spracovania"),1),g.value!=="preview"?(i(),$(o(x),{key:0,type:"button",size:"sm",variant:"outline",onClick:e[5]||(e[5]=s=>g.value="preview")},{default:r(()=>[...e[36]||(e[36]=[v(" Späť na náhľad ",-1)])]),_:1})):D("",!0)]),O(t("div",_s,[l.value.preview_status!=="done"?(i(),p("div",gs,[...e[37]||(e[37]=[t("span",{class:"inline-flex h-4 w-4 animate-spin rounded-full border-2 border-muted-foreground/40 border-t-muted-foreground"},null,-1),t("span",null,"Náhľad sa generuje. Skús to o chvíľu znova.",-1)])])):(i(),p("div",bs,[t("div",hs,[t("div",{class:"origin-top-left inline-block",style:se({transform:`scale(${k.value})`})},[t("img",{src:Oe.value,alt:"Náhľad dokumentu",class:"w-full max-w-[1000px] rounded-md border"},null,8,ys)],4)])])),l.value&&l.value.preview_status==="done"?(i(),p("div",ws,[t("div",ks,[n(o(x),{variant:"outline",size:"icon",disabled:k.value<=ke,onClick:Xe,"aria-label":"Oddialiť",title:"Oddialiť"},{default:r(()=>[n(o(ye),{class:"h-4 w-4"})]),_:1},8,["disabled"]),t("div",$s,u(Math.round(k.value*100))+"% ",1),n(o(x),{variant:"outline",size:"icon",disabled:k.value>=$e,onClick:Qe,"aria-label":"Priblížiť",title:"Priblížiť"},{default:r(()=>[n(o(ct),{class:"h-4 w-4"})]),_:1},8,["disabled"])]),n(o(x),{variant:"outline",size:"sm",disabled:w.value<=1,onClick:He},{default:r(()=>[...e[38]||(e[38]=[v(" Predchádzajúca ",-1)])]),_:1},8,["disabled"]),t("div",Ss," Strana "+u(w.value)+" / "+u(l.value.preview_page_count??1),1),n(o(x),{variant:"outline",size:"sm",disabled:w.value>=(l.value.preview_page_count??1),onClick:Je},{default:r(()=>[...e[39]||(e[39]=[v(" Nasledujúca ",-1)])]),_:1},8,["disabled"])])):D("",!0)],512),[[H,g.value==="preview"]]),O(t("div",Cs,[t("div",zs,u(l.value.ocr_status_label),1),t("div",Ns,u(l.value.ocr_text||"OCR prepis zatiaľ nie je dostupný."),1)],512),[[H,g.value==="ocr"]]),O(t("div",js,[t("div",Ps,[e[41]||(e[41]=t("div",{class:"text-sm text-muted-foreground"}," Analýza textu ",-1)),t("div",Ds,[n(o(x),{type:"button",size:"sm",variant:"outline",onClick:e[6]||(e[6]=s=>Re(l.value.id)),disabled:!l.value.ocr_text},{default:r(()=>[...e[40]||(e[40]=[v(" Vygenerovať denník ",-1)])]),_:1},8,["disabled"])])]),t("div",As,[t("pre",Ms,""+u(l.value.processed_diary_data?JSON.stringify(l.value.processed_diary_data,null,2):"Spracované údaje zatiaľ nie sú dostupné.")+`
                                        `,1)])],512),[[H,g.value==="processed"]]),O(t("div",Us,[!l.value.processing_log||l.value.processing_log.length===0?(i(),p("div",Vs," Žiadny log zatiaľ nie je dostupný. ")):(i(),p("div",Fs,[t("table",Ts,[e[42]||(e[42]=t("thead",{class:"sticky top-0 bg-muted text-left"},[t("tr",null,[t("th",{class:"px-3 py-2 font-medium"},"Čas"),t("th",{class:"px-3 py-2 font-medium"},"Krok"),t("th",{class:"px-3 py-2 font-medium"},"Typ"),t("th",{class:"px-3 py-2 font-medium"},"Správa")])],-1)),t("tbody",null,[(i(!0),p(M,null,L([...l.value.processing_log].reverse(),(s,m)=>(i(),p("tr",{key:m,class:"border-t"},[t("td",Es,u(ue(s.time)),1),t("td",Is,u(s.step),1),t("td",Bs,[t("span",{class:h(["rounded px-2 py-0.5 text-xs font-medium uppercase tracking-wide",je(s.type)])},u(s.type),3)]),t("td",Ls,u(s.message),1)]))),128))])])]))],512),[[H,g.value==="log"]])]),t("div",Rs,[t("div",Os,[t("div",null,[e[44]||(e[44]=t("div",{class:"text-xs font-semibold uppercase text-muted-foreground"}," Názov dokumentu ",-1)),t("div",qs,[n(o(he),{modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=s=>F.value=s),class:"h-9"},null,8,["modelValue"]),n(o(x),{type:"button",size:"sm",disabled:T.value,onClick:Ze},{default:r(()=>[...e[43]||(e[43]=[v(" Uložiť ",-1)])]),_:1},8,["disabled"])])]),t("div",Ks,[t("div",Zs,[e[45]||(e[45]=t("span",{class:"text-muted-foreground"},"Typ",-1)),t("span",Gs,u(l.value.type),1)]),t("div",Hs,[e[46]||(e[46]=t("span",{class:"text-muted-foreground"},"Veľkosť",-1)),t("span",Js,u(ie(l.value.size)),1)]),t("div",Qs,[e[47]||(e[47]=t("span",{class:"text-muted-foreground"},"Nahrané",-1)),t("span",Xs,u(Ne(l.value.created_at)),1)])]),t("div",Ys,[e[53]||(e[53]=t("div",{class:"text-xs font-semibold uppercase text-muted-foreground"}," Spracovanie ",-1)),t("div",Ws,[e[48]||(e[48]=t("span",{class:"text-muted-foreground"},"Stav",-1)),t("span",ea,u(l.value.processing_status_label),1)]),t("button",{type:"button",class:"flex w-full items-center justify-between text-sm transition hover:text-foreground",onClick:e[8]||(e[8]=s=>g.value="preview")},[e[49]||(e[49]=t("span",{class:"text-muted-foreground underline underline-offset-2 decoration-dotted"}," Preview ",-1)),(i(),$(C(c(l.value.preview_status).icon),{class:h(["h-4 w-4",[c(l.value.preview_status).className,c(l.value.preview_status).spin?"animate-spin":""]]),title:l.value.preview_status_label,"aria-label":l.value.preview_status_label},null,8,["class","title","aria-label"]))]),t("button",{type:"button",class:"flex w-full items-center justify-between text-sm transition hover:text-foreground",onClick:e[9]||(e[9]=s=>g.value="ocr")},[e[50]||(e[50]=t("span",{class:"text-muted-foreground underline underline-offset-2 decoration-dotted"}," OCR ",-1)),(i(),$(C(c(l.value.ocr_status).icon),{class:h(["h-4 w-4",[c(l.value.ocr_status).className,c(l.value.ocr_status).spin?"animate-spin":""]]),title:l.value.ocr_status_label,"aria-label":l.value.ocr_status_label},null,8,["class","title","aria-label"]))]),t("button",{type:"button",class:"flex w-full items-center justify-between text-sm transition hover:text-foreground",onClick:e[10]||(e[10]=s=>g.value="processed")},[e[51]||(e[51]=t("span",{class:"text-muted-foreground underline underline-offset-2 decoration-dotted"}," Analyze ",-1)),(i(),$(C(c(l.value.analyze_text_status).icon),{class:h(["h-4 w-4",[c(l.value.analyze_text_status).className,c(l.value.analyze_text_status).spin?"animate-spin":""]]),title:l.value.analyze_text_status_label,"aria-label":l.value.analyze_text_status_label},null,8,["class","title","aria-label"]))]),t("button",{type:"button",class:"flex w-full items-center justify-between text-sm transition hover:text-foreground",onClick:e[11]||(e[11]=s=>g.value="processed")},[e[52]||(e[52]=t("span",{class:"text-muted-foreground underline underline-offset-2 decoration-dotted"}," RAG ",-1)),(i(),$(C(c(l.value.rag_status).icon),{class:h(["h-4 w-4",[c(l.value.rag_status).className,c(l.value.rag_status).spin?"animate-spin":""]]),title:l.value.rag_status_label,"aria-label":l.value.rag_status_label},null,8,["class","title","aria-label"]))])]),n(o(x),{type:"button",size:"sm",variant:"outline",class:"w-full",onClick:e[12]||(e[12]=s=>g.value="log")},{default:r(()=>[...e[54]||(e[54]=[v(" Log spracovania ",-1)])]),_:1}),t("div",ta,[n(o(x),{type:"button",size:"sm",class:"w-full",onClick:Ge},{default:r(()=>[...e[55]||(e[55]=[v(" Spusti spracovanie ",-1)])]),_:1}),t("a",{href:`/archive-documents/${l.value.id}/download`,class:"inline-flex items-center justify-center rounded-md border border-input bg-background px-3 py-2 text-sm font-medium transition hover:bg-accent hover:text-accent-foreground"}," Stiahnuť dokument ",8,sa)])])])])])])):(i(),p("div",ds," Vyber dokument. "))])]),_:1})]),_:1},8,["open"]),n(o(Y),{open:E.value,"onUpdate:open":e[16]||(e[16]=s=>E.value=!1)},{default:r(()=>[n(o(J),{class:"sm:max-w-md"},{default:r(()=>[n(o(Q),null,{default:r(()=>[n(o(X),null,{default:r(()=>[...e[56]||(e[56]=[v("Spustiť spracovanie",-1)])]),_:1})]),_:1}),e[60]||(e[60]=t("div",{class:"text-sm text-muted-foreground"}," Chceš spracovať len chýbajúce časti, alebo celé spracovanie od začiatku? ",-1)),n(o(le),{class:"gap-2"},{default:r(()=>[n(o(x),{type:"button",variant:"outline",onClick:e[13]||(e[13]=s=>E.value=!1)},{default:r(()=>[...e[57]||(e[57]=[v(" Zrušiť ",-1)])]),_:1}),n(o(x),{type:"button",variant:"outline",onClick:e[14]||(e[14]=s=>ve("missing"))},{default:r(()=>[...e[58]||(e[58]=[v(" Len chýbajúce ",-1)])]),_:1}),n(o(x),{type:"button",onClick:e[15]||(e[15]=s=>ve("full"))},{default:r(()=>[...e[59]||(e[59]=[v(" Celé spracovanie ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64))}});export{$a as default};
