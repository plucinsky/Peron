import{d as X,r as b,c as z,b as n,e as o,f as m,g as e,h as l,i as Y,l as r,q as N,j as w,t as f,F as V,m as P,k as F,p as ee,B as te}from"./app-CfhKYtt7.js";import{_ as k}from"./index-DGVHeVnd.js";import{_ as se,a as oe,b as ae,c as le}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DRKyjPaX.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-CteKsvKh.js";import{_ as ne,C as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-CuPyALle.js";import{c as O}from"./createLucideIcon-6vwJQ8y7.js";import{M as ie,P as de}from"./plus-D2otycPr.js";import"./useForwardPropsEmits-BMR9Dotv.js";import"./index-DI3qepia.js";import"./VisuallyHidden-CsCPmOFa.js";import"./useForwardExpose-iik2X7Kc.js";import"./index-CqmfE78h.js";import"./index-CSEUMRIG.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CJkCubQI.js";const ce=O("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const B=O("FileSearchIcon",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]),ue={class:"flex min-h-[70vh] flex-col"},me={key:0,class:"flex flex-1 items-center justify-center px-6 py-12"},fe={class:"flex w-full max-w-3xl flex-col items-center gap-6 text-center"},ve={class:"flex h-14 w-14 items-center justify-center rounded-full bg-muted"},he={key:1,class:"flex flex-col gap-6 p-6"},pe={class:"rounded-xl border border-border/70 bg-muted p-6 shadow-sm"},_e={class:"flex flex-col gap-4"},xe={class:"flex items-center gap-3"},ge={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted"},be={class:"grid gap-6 lg:grid-cols-2"},we={class:"rounded-xl border bg-background p-6 shadow-sm"},ke={key:0,class:"mt-4 text-sm text-destructive"},ye=["innerHTML"],$e={key:2,class:"mt-4 text-base text-foreground"},je={class:"rounded-xl border bg-muted/20 p-6 shadow-sm"},ze={key:0,class:"mt-4 text-sm text-muted-foreground"},Me={key:1,class:"mt-4 space-y-4"},Ve=["onClick"],qe={class:"flex gap-3"},Ce={class:"h-20 w-16 shrink-0 overflow-hidden rounded-md border border-border/60 bg-background"},Se=["src","alt"],Ne={class:"min-w-0 flex-1"},Pe={class:"text-sm font-semibold text-foreground"},Fe={class:"text-xs text-muted-foreground"},Le={key:0,class:"mt-2 space-y-1 text-xs text-muted-foreground"},Be={class:"flex min-h-0 flex-1 flex-col gap-4"},He={class:"rounded-md border bg-background p-3"},Ie={class:"flex flex-wrap items-center justify-between gap-3 text-sm"},Oe={class:"text-muted-foreground"},Ue={class:"flex items-center gap-2"},Ze={class:"min-w-[56px] text-center text-xs font-medium text-muted-foreground"},Te={class:"text-xs text-muted-foreground"},We={key:0},Ae={class:"flex min-h-0 flex-1 flex-col items-start justify-start overflow-auto rounded-md border bg-muted p-4"},De={key:0,class:"text-sm text-muted-foreground"},Ee={key:1,class:"flex min-w-full justify-center"},Re=["src","alt"],H=.6,I=2.5,ct=X({__name:"Search",props:{query:{},answer:{},sources:{},error:{}},setup(U){const d=U,Z=[{title:"Vyhľadávanie",href:"/search"}],x=b(d.query??""),g=b(!1),q=z(()=>[...d.sources].sort((c,a)=>c.distance-a.distance)),T=z(()=>!d.query&&!d.answer&&!d.error&&d.sources.length===0),j=b(!1),i=b(null),v=b(1),h=b(1),W=z(()=>i.value?`/archive-documents/${i.value.id}/preview/${v.value}`:"");function A(c){i.value=c,v.value=1,h.value=1,j.value=!0}function D(c){if(c){j.value=!0;return}j.value=!1,i.value=null,v.value=1,h.value=1}function E(){h.value=Math.min(I,+(h.value+.1).toFixed(2))}function R(){h.value=Math.max(H,+(h.value-.1).toFixed(2))}function G(){v.value>1&&(v.value-=1)}function J(){const c=i.value?.preview_page_count??null;(!c||v.value<c)&&(v.value+=1)}function K(c){const t=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").split(`
`);let p="",s=0;const y=_=>_.replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>");for(;s<t.length;){const _=t[s];if(_.trim()===""){s+=1;continue}const M=_.match(/^(#{1,3})\s+(.*)$/);if(M){const u=M[1].length;p+=`<h${u}>${y(M[2])}</h${u}>`,s+=1;continue}if(_.startsWith("> ")){const u=[];for(;s<t.length&&t[s].startsWith("> ");)u.push(t[s].slice(2)),s+=1;p+=`<blockquote>${y(u.join("<br>"))}</blockquote>`;continue}if(_.match(/^[-*]\s+(.*)$/)){const u=[];for(;s<t.length;){const $=t[s].match(/^[-*]\s+(.*)$/);if(!$)break;u.push(`<li>${y($[1])}</li>`),s+=1}p+=`<ul>${u.join("")}</ul>`;continue}if(_.match(/^\d+\.\s+(.*)$/)){const u=[];for(;s<t.length;){const $=t[s].match(/^\d+\.\s+(.*)$/);if(!$)break;u.push(`<li>${y($[1])}</li>`),s+=1}p+=`<ol>${u.join("")}</ol>`;continue}const S=[];for(;s<t.length&&t[s].trim()!=="";)S.push(t[s]),s+=1;p+=`<p>${y(S.join("<br>"))}</p>`}return p}const Q=z(()=>d.answer?K(d.answer):"");function C(){x.value.trim()&&(g.value=!0,te.post("/search",{query:x.value},{preserveScroll:!0,onFinish:()=>{g.value=!1}}))}return(c,a)=>(r(),n(V,null,[o(ne,{breadcrumbs:Z},{default:m(()=>[o(l(Y),{title:"Vyhľadávanie"}),e("div",ue,[T.value?(r(),n("div",me,[e("div",fe,[e("div",ve,[o(l(B),{class:"h-7 w-7 text-foreground"})]),a[2]||(a[2]=e("div",{class:"space-y-2"},[e("div",{class:"text-sm font-semibold uppercase tracking-wide text-muted-foreground"}," Mudrlant "),e("div",{class:"text-3xl font-semibold text-foreground sm:text-4xl"}," Čo ťa zaujíma? "),e("div",{class:"text-base text-muted-foreground"}," Opýtaj sa ma, čo ťa zaujíma a ja ti odpoviem s informácií z archívu. ")],-1)),e("form",{class:"flex w-full flex-col gap-3 sm:flex-row",onSubmit:N(C,["prevent"])},[o(l(L),{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=t=>x.value=t),class:"h-12 flex-1 text-base",placeholder:"Napíš svoju otázku..."},null,8,["modelValue"]),o(l(k),{type:"submit",disabled:g.value,class:"h-12 px-6"},{default:m(()=>[w(f(g.value?"Hľadám...":"Vyhľadať"),1)]),_:1},8,["disabled"])],32)])])):(r(),n("div",he,[e("div",pe,[e("div",_e,[e("div",xe,[e("div",ge,[o(l(B),{class:"h-5 w-5 text-foreground"})]),a[3]||(a[3]=e("div",null,[e("div",{class:"text-xl font-semibold"},"Mudrlant"),e("div",{class:"text-sm text-muted-foreground"}," Vyhľadávanie v archívnych dokumentoch. ")],-1))]),e("form",{class:"flex flex-col gap-3 sm:flex-row sm:items-center",onSubmit:N(C,["prevent"])},[o(l(L),{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=t=>x.value=t),class:"h-12 flex-1 bg-background text-base",placeholder:"Napíš, čo hľadáš..."},null,8,["modelValue"]),o(l(k),{type:"submit",disabled:g.value,class:"h-12 px-6"},{default:m(()=>[w(f(g.value?"Hľadám...":"Vyhľadať"),1)]),_:1},8,["disabled"])],32)])]),e("div",be,[e("div",we,[a[4]||(a[4]=e("div",{class:"text-sm font-semibold uppercase text-muted-foreground"}," Odpoveď ",-1)),d.error?(r(),n("div",ke,f(d.error),1)):d.answer?(r(),n("div",{key:1,class:"mt-4 text-base text-foreground [&_blockquote]:border-l-2 [&_blockquote]:border-border [&_blockquote]:pl-3 [&_blockquote]:text-muted-foreground [&_code]:rounded [&_code]:bg-muted [&_code]:px-1 [&_code]:py-0.5 [&_h1]:mb-3 [&_h1]:text-xl [&_h1]:font-semibold [&_h2]:mb-3 [&_h2]:text-lg [&_h2]:font-semibold [&_h3]:mb-2 [&_h3]:text-base [&_h3]:font-semibold [&_ol]:mb-3 [&_ol]:list-decimal [&_ol]:pl-5 [&_p]:mb-3 [&_ul]:mb-3 [&_ul]:list-disc [&_ul]:pl-5",innerHTML:Q.value},null,8,ye)):(r(),n("div",$e," Zatiaľ nie je dostupná žiadna odpoveď. "))]),e("div",je,[a[5]||(a[5]=e("div",{class:"text-sm font-semibold uppercase text-muted-foreground"}," Pouzite zdroje informacii ",-1)),q.value.length===0?(r(),n("div",ze," Zatiaľ nemáme žiadne zdroje. ")):(r(),n("div",Me,[(r(!0),n(V,null,P(q.value,t=>(r(),n("div",{key:t.id,class:"cursor-pointer rounded-lg border border-border/60 bg-muted/10 p-3 transition hover:border-border",onClick:p=>A(t)},[e("div",qe,[e("div",Ce,[e("img",{src:`/archive-documents/${t.id}/preview/1`,alt:`Náhľad ${t.name}`,class:"h-full w-full object-cover",loading:"lazy"},null,8,Se)]),e("div",Ne,[e("div",Pe,f(t.name),1),e("div",Fe,f(t.original_filename||"Bez názvu"),1),t.excerpts.length?(r(),n("div",Le,[(r(!0),n(V,null,P(t.excerpts.slice(0,2),(p,s)=>(r(),n("div",{key:s}," “"+f(p)+"” ",1))),128))])):F("",!0)])])],8,Ve))),128))]))])])]))])]),_:1}),o(l(le),{open:j.value,"onUpdate:open":D},{default:m(()=>[o(l(se),{class:"flex max-h-[85vh] flex-col overflow-hidden sm:max-w-6xl"},{default:m(()=>[o(l(oe),null,{default:m(()=>[o(l(ae),null,{default:m(()=>[w(f(i.value?.name||"Náhľad dokumentu"),1)]),_:1})]),_:1}),e("div",Be,[e("div",He,[e("div",Ie,[e("div",Oe,f(i.value?.original_filename||"Bez názvu"),1),e("div",Ue,[o(l(k),{variant:"outline",size:"icon",disabled:h.value<=H,onClick:R,"aria-label":"Oddialiť"},{default:m(()=>[o(l(ie),{class:"h-4 w-4"})]),_:1},8,["disabled"]),e("div",Ze,f(Math.round(h.value*100))+"% ",1),o(l(k),{variant:"outline",size:"icon",disabled:h.value>=I,onClick:E,"aria-label":"Priblížiť"},{default:m(()=>[o(l(de),{class:"h-4 w-4"})]),_:1},8,["disabled"]),o(l(k),{variant:"outline",size:"sm",disabled:v.value<=1,onClick:G},{default:m(()=>[o(l(ce),{class:"mr-1 h-4 w-4"}),a[6]||(a[6]=w(" Predchádzajúca ",-1))]),_:1},8,["disabled"]),e("div",Te,[w(" Strana "+f(v.value)+" ",1),i.value?.preview_page_count?(r(),n("span",We," / "+f(i.value.preview_page_count),1)):F("",!0)]),o(l(k),{variant:"outline",size:"sm",disabled:i.value?.preview_page_count?v.value>=i.value.preview_page_count:!1,onClick:J},{default:m(()=>[a[7]||(a[7]=w(" Nasledujúca ",-1)),o(l(re),{class:"ml-1 h-4 w-4"})]),_:1},8,["disabled"])])])]),e("div",Ae,[i.value?.preview_status!=="done"?(r(),n("div",De," Náhľad dokumentu ešte nie je pripravený. ")):(r(),n("div",Ee,[e("div",{class:"origin-top-left inline-block",style:ee({transform:`scale(${h.value})`})},[e("img",{src:W.value,alt:`Náhľad ${i.value?.name||""}`,class:"w-full max-w-[1000px] rounded-md border"},null,8,Re)],4)]))])])]),_:1})]),_:1},8,["open"])],64))}});export{ct as default};
